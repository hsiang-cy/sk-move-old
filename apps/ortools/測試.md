# VRP Solver 測試紀錄

本文件記錄了使用 Modal Serverless 進行 OR-Tools 求解的測試過程與結果。

## 測試時間
- **日期**: 2026年2月21日
- **環境**: Modal Dev Server (`modal serve`)

## 測試指令 (cURL)

```bash
curl -X POST "https://tile-zip--ortools-vrp-solver-api-dev.modal.run/vrp/solve" 
-H "Content-Type: application/json" 
-d '{
  "webhook_url": "https://webhook.site/d2e3dda5-8a67-4e92-bdce-ffe4b68458cd",
  "depot_index": 0,
  "locations": [
    {"id": 0, "name": "台北車站 (Depot)", "lat": 25.0478, "lng": 121.5170, "pickup": 0, "delivery": 0, "service_time": 0, "time_window_start": 0, "time_window_end": 1440},
    {"id": 1, "name": "中正區 A", "lat": 25.0421, "lng": 121.5340, "pickup": 0, "delivery": 5, "service_time": 10, "time_window_start": 60, "time_window_end": 300},
    {"id": 2, "name": "中山區 B", "lat": 25.0521, "lng": 121.5240, "pickup": 0, "delivery": 3, "service_time": 10, "time_window_start": 0, "time_window_end": 1440},
    {"id": 3, "name": "萬華區 C", "lat": 25.0321, "lng": 121.5040, "pickup": 0, "delivery": 4, "service_time": 15, "time_window_start": 120, "time_window_end": 480},
    {"id": 4, "name": "松山區 D", "lat": 25.0621, "lng": 121.5440, "pickup": 0, "delivery": 2, "service_time": 5, "time_window_start": 0, "time_window_end": 1440},
    {"id": 5, "name": "板橋區 E", "lat": 25.0221, "lng": 121.4940, "pickup": 0, "delivery": 6, "service_time": 10, "time_window_start": 0, "time_window_end": 1440}
  ],
  "vehicles": [
    {"id": 101, "capacity": 15, "fixed_cost": 100},
    {"id": 102, "capacity": 15, "fixed_cost": 100}
  ],
  "distance_matrix": [
    [0, 2000, 1500, 2500, 3500, 4000],
    [2000, 0, 1200, 3000, 1500, 5000],
    [1500, 1200, 0, 2000, 2500, 3500],
    [2500, 3000, 2000, 0, 4000, 1500],
    [3500, 1500, 2500, 4000, 0, 5500],
    [4000, 5000, 3500, 1500, 5500, 0]
  ],
  "time_matrix": [
    [0, 10, 8, 15, 20, 25],
    [10, 0, 6, 18, 12, 30],
    [8, 6, 0, 12, 15, 22],
    [15, 18, 12, 0, 25, 10],
    [20, 12, 15, 25, 0, 35],
    [25, 30, 22, 10, 35, 0]
  ],
  "time_limit_seconds": 10
}'
```

## 求解結果 (Webhook Payload)

```json
{
  "job_id": "645c0612-7e07-4198-ae54-49d0e41eadad",
  "status": "success",
  "total_distance": 15500,
  "routes": [
    {
      "vehicle_id": 101,
      "stops": [
        {"location_id": 0, "name": "台北車站 (Depot)", "arrival_time": 0, "pickup": 0, "delivery": 0},
        {"location_id": 3, "name": "萬華區 C", "arrival_time": 120, "pickup": 0, "delivery": 4},
        {"location_id": 5, "name": "板橋區 E", "arrival_time": 145, "pickup": 0, "delivery": 6},
        {"location_id": 0, "name": "台北車站 (Depot)", "arrival_time": 180, "pickup": 0, "delivery": 0}
      ],
      "total_distance": 8000,
      "total_pickup": 0,
      "total_delivery": 10
    },
    {
      "vehicle_id": 102,
      "stops": [
        {"location_id": 0, "name": "台北車站 (Depot)", "arrival_time": 0, "pickup": 0, "delivery": 0},
        {"location_id": 1, "name": "中正區 A", "arrival_time": 60, "pickup": 0, "delivery": 5},
        {"location_id": 4, "name": "松山區 D", "arrival_time": 82, "pickup": 0, "delivery": 2},
        {"location_id": 2, "name": "中山區 B", "arrival_time": 102, "pickup": 0, "delivery": 3},
        {"location_id": 0, "name": "台北車站 (Depot)", "arrival_time": 120, "pickup": 0, "delivery": 0}
      ],
      "total_distance": 7500,
      "total_pickup": 0,
      "total_delivery": 10
    }
  ]
}
```

## 測試結論
1. **邏輯正確性**: 車輛載重分配與時間窗約束皆獲得滿足。
2. **架構效能**: Modal Serverless 處理請求反應迅速，非同步作業與 Webhook 機制正常運作。
